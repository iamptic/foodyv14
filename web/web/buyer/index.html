<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Foody — витрина</title>
  <style>
    :root{
      --bg:#fafafa; --text:#111; --sub:#666; --muted:#999;
      --card:#fff; --line:#eee; --brand:#0a7cff; --ok:#12a150; --danger:#e5484d;
      --shadow:0 6px 18px rgba(0,0,0,.06);
      --radius:14px;
      --safe-b: env(safe-area-inset-bottom, 0);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font:16px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Inter,Arial}
    a{color:var(--brand);text-decoration:none}
    .site-header,.site-footer{background:#fff;border-bottom:1px solid var(--line)}
    .site-footer{border-top:1px solid var(--line);border-bottom:none}
    .site-header,.site-footer{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 16px;position:sticky;top:0;z-index:10
    }
    .brand{display:flex;gap:10px;align-items:center;font-weight:600}
    .page{max-width:1100px;margin:16px auto;padding:0 12px calc(20px + var(--safe-b))}
    .btn{
      -webkit-appearance:none;appearance:none;border:1px solid var(--brand);
      color:#fff;background:var(--brand);padding:10px 14px;border-radius:10px;
      cursor:pointer;font-weight:600
    }
    .btn:hover{filter:brightness(.95)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn-secondary{background:#fff;color:var(--brand)}
    .input{
      width:100%;background:#fff;border:1px solid var(--line);padding:12px 14px;border-radius:10px;outline:none
    }
    .filters{margin:8px 0 16px}
    .filters-row{display:flex;gap:10px}
    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:14px}
    @media (min-width:540px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}

    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;position:relative}
    .photo{position:relative;aspect-ratio:4/3;background:#f3f3f3}
    .photo img{width:100%;height:100%;object-fit:cover;display:block}
    .badge{position:absolute;left:10px;top:10px;background:#111cc7;color:#fff;padding:6px 10px;border-radius:999px;font-size:13px;font-weight:700}
    .badge.badge--timer{right:10px;left:auto;background:#111;opacity:.9}
    .info{padding:12px;display:flex;flex-direction:column;gap:6px}
    .title{margin:0 0 2px;font-size:16px;line-height:1.2}
    .desc{margin:0;color:var(--sub);font-size:14px}
    .row{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .price{font-weight:800}
    .muted{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px;margin-top:6px}
    .btn-buy{flex:1}

    .skeleton{animation:shimmer 1.2s infinite linear;background:
      linear-gradient(100deg, #eee 40%, #f7f7f7 50%, #eee 60%) 0 0/200% 100%;
      border-radius:12px}
    .skel-photo{height:180px}
    .skel-line{height:14px;margin-top:8px}
    @keyframes shimmer{to{background-position:200% 0}}

    .status{min-height:20px;margin:6px 0 10px;color:var(--sub)}
    .alert{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#fff}
    .alert.error{border-color:#ffd3d6;background:#fff6f6;color:var(--danger)}

    /* MODAL */
    .modal{position:fixed;inset:0;display:none}
    .modal[aria-hidden="false"]{display:block}
    .modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.35)}
    .modal__sheet{
      position:relative;max-width:520px;margin:8vh auto;background:#fff;border-radius:16px;
      padding:16px 16px calc(16px + var(--safe-b));border:1px solid var(--line);box-shadow:var(--shadow)
    }
    .modal__close{position:absolute;right:10px;top:10px;border:none;background:transparent;font-size:20px;line-height:1;cursor:pointer}
    .modal__title{margin:4px 0 4px}
    .modal__subtitle{margin:0 0 8px;color:var(--sub)}
    .modal__qr-wrap{display:flex;justify-content:center;align-items:center;min-height:220px;margin:6px 0 8px}
    .modal__qr{width:220px;height:220px;border-radius:12px;border:1px solid var(--line);object-fit:contain;background:#fff}
    .modal__code{font-size:28px;font-weight:900;letter-spacing:.08em;background:#f7f7f7;border:1px solid var(--line);padding:10px 14px;border-radius:12px}
    .modal__meta{display:flex;justify-content:space-between;gap:8px;margin:6px 0 10px}
    .modal__actions{display:flex;gap:8px;justify-content:flex-end}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <span>Foody — предложения рядом</span>
    </div>
    <nav class="actions">
      <a class="btn" href="../merchant/">Я — ресторан</a>
    </nav>
  </header>

  <main class="page">
    <section class="filters">
      <div class="filters-row">
        <input id="q" class="input" placeholder="Поиск по названию…" />
        <button id="refresh" class="btn btn-secondary">Обновить</button>
      </div>
    </section>

    <section id="status" class="status" aria-live="polite"></section>
    <section id="offers" class="grid" aria-busy="true"></section>
  </main>

  <footer class="site-footer">
    <small>© Foody, 2025</small>
  </footer>

  <!-- Modal -->
  <div id="modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__sheet" role="document">
      <button class="modal__close" type="button" title="Закрыть" data-close>✕</button>
      <h3 class="modal__title">Бронирование</h3>
      <p class="modal__subtitle">Покажите этот код на точке</p>

      <div class="modal__qr-wrap">
        <img id="qrImg" class="modal__qr" alt="QR код" />
        <div id="qrFallback" class="modal__code" style="display:none"></div>
      </div>

      <div class="modal__meta">
        <div><span class="muted">Оффер #</span> <span id="mOfferId">—</span></div>
        <div><span class="muted">Действительно до</span> <span id="mExpires">—</span></div>
      </div>

      <div class="modal__actions">
        <button id="copyBtn" class="btn">Скопировать код</button>
        <button class="btn btn-secondary" data-close>Готово</button>
      </div>
    </div>
  </div>

  <script>
    window.FOODY_API = window.FOODY_API || "https://foodyback-production.up.railway.app";
    window.QR_URL_BUILDER = window.QR_URL_BUILDER || (payload =>
      `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(payload)}`);
  </script>
  <script src="./app.js"></script>
</body>
</html>
